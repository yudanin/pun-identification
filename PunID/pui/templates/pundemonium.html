<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pun Analyzer - Pundemonium</title>
    <style>
        * {
            box-sizing: border-box;
        }

        @keyframes gradientShift {
            0% { background-position: 0% center; }
            50% { background-position: 100% center; }
            100% { background-position: 0% center; }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
            color: #333;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }

        header h1 {
            margin: 0 0 10px 0;
        }

        header p {
            margin: 0;
            opacity: 0.9;
        }

        section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h2 {
            margin-top: 0;
            color: #667eea;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .status-message.info {
            background: #e3f2fd;
            color: #1565c0;
        }

        .status-message.error {
            background: #ffebee;
            color: #c62828;
        }

        .status-message.success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        /* Loading overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #loading-overlay.hidden {
            display: none;
        }

        #loading-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
        }

        #loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #eee;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #fact-display {
            color: #666;
            font-style: italic;
            line-height: 1.6;
        }

        /* Results styling */
        .sentence-result {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 25px;
            overflow: hidden;
        }

        .sentence-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .sentence-text {
            font-size: 18px;
            font-weight: 500;
            color: #333;
            margin: 0;
        }

        .pun-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }

        .pun-status.has-pun {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .pun-status.no-pun {
            background: #fff3e0;
            color: #e65100;
        }

        .pun-card {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .pun-card:last-child {
            border-bottom: none;
        }

        .pun-expression {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin: 0 0 20px 0;
        }

        .analysis-section {
            margin-bottom: 20px;
        }

        .analysis-section h4 {
            margin: 0 0 12px 0;
            color: #444;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .analysis-section h4::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 16px;
            border-radius: 2px;
        }

        .claude-section h4::before {
            background: #667eea;
        }

        .framenet-section h4::before {
            background: #ff7043;
        }

        .validation-section h4::before {
            background: #26a69a;
        }

        .analysis-grid {
            display: grid;
            gap: 10px;
        }

        .analysis-item {
            display: flex;
            gap: 10px;
        }

        .analysis-label {
            font-weight: 600;
            color: #666;
            min-width: 120px;
            flex-shrink: 0;
        }

        .analysis-value {
            color: #333;
        }

        .pun-type-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .pun-type-badge.homophonic {
            background: #e3f2fd;
            color: #1565c0;
        }

        .pun-type-badge.homographic {
            background: #f3e5f5;
            color: #7b1fa2;
        }

        .pun-type-badge.recursive {
            background: #fff3e0;
            color: #e65100;
        }

        .pun-type-badge.antanaclasis {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .pun-type-badge.unknown {
            background: #eceff1;
            color: #546e7a;
        }

        .frame-box {
            background: #fafafa;
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 12px;
            margin-top: 8px;
        }

        .frame-name {
            font-weight: 600;
            color: #ff7043;
            margin-bottom: 5px;
        }

        .frame-definition {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }

        .distance-value {
            font-size: 20px;
            font-weight: 700;
            color: #ff7043;
        }

        .confidence-bar {
            background: #eee;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #26a69a, #66bb6a);
            border-radius: 4px;
            transition: width 0.3s;
        }

        .validation-status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .validation-status.valid {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .validation-status.invalid {
            background: #ffebee;
            color: #c62828;
        }

        .notes-box {
            background: #fffde7;
            border-left: 4px solid #ffc107;
            padding: 12px 15px;
            margin-top: 15px;
            border-radius: 0 6px 6px 0;
            font-style: italic;
            color: #666;
        }

        .no-pun-message {
            padding: 20px;
            text-align: center;
            color: #666;
        }

        /* Raw JSON toggle */
        .raw-json-toggle {
            margin-top: 20px;
            text-align: center;
        }

        .raw-json-toggle button {
            background: #eceff1;
            color: #546e7a;
            padding: 8px 16px;
            font-size: 13px;
        }

        #json-output {
            background: #263238;
            color: #aed581;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            display: none;
            margin-top: 15px;
        }

        #json-output.visible {
            display: block;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cherry+Bomb+One&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <h1 style='font-family: "Cherry Bomb One", system-ui;font-size:6em;font-weight:400;font-style: normal;
            background: linear-gradient(90deg, #ff0000, #8B0000, #ffd700, #8B4513, #228B22, #ff8c00, #ff0000);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 5s ease forwards;
            -webkit-text-stroke: 2px white'>
            PUNDEMONIUM
        </h1>
        <h1>ðŸ¥§ Pun Identification Engine ðŸ¥§ </h1>
        <p>A Linguistic Analysis Tool Powered by Claude & FrameNet</p>
    </header>

    <main>
        <section id="input-section">
            <h2>Submit Sentence(s)</h2>
            <p>Enter one or more sentences below (one per line). Maximum 10 sentences for batch analysis.</p>
            <textarea id="sentence-input" placeholder="Example: Atheism is a non-prophet institution."></textarea>
            <button id="analyze-button" onclick="analyzeSentences()">Analyze Pun(s)</button>
        </section>

        <section id="results-section">
            <h2>Analysis Results</h2>

            <div id="final-status-message" class="status-message info">
                Results will appear here after analysis.
            </div>

            <div id="results-container"></div>

            <div class="raw-json-toggle">
                <button onclick="toggleRawJson()">Show/Hide Raw JSON</button>
            </div>
            <pre id="json-output"></pre>
        </section>
    </main>

    <div id="loading-overlay" class="hidden">
        <div id="loading-box">
            <div id="loading-spinner"></div>
            <p id="fact-display"></p>
        </div>
    </div>

    <script>
        const FACT_INTERVAL = 7000;
        let rotationIntervalId = null;
        let currentFactIndex = 0;

        const PUN_FACTS = [
            "Puns are ancient: Puns were used in ancient civilizations like Mesopotamia (around 2500 BC), Egypt, and by the Maya for everything from religious myths to hieroglyphic writing.",
            "Shakespeare loved them: William Shakespeare, one of the greatest writers in the English language, used puns frequently in his works, including many explicit jokes and clever wordplay.",
            "English is great for puns: The English language's vast vocabulary (borrowed from many other languages) and lack of word declensions make it especially fertile ground for wordplay and puns.",
            "There are several types: Puns can be homophonic (words that sound the same but have different meanings, like 'Czech' and 'check'), homographic (words spelled the same but sound different), homonymic (same sound and spelling), or portmanteaus (combined words like 'brunch').",
            "Brain activity is unique: When someone understands a funny pun, a specific region in the brain called the inferior frontal gyrus (IFG) shows increased activity, suggesting a unique neurological process is involved in 'getting' the joke.",
            "Computers struggle with them: Replicating the human ability to create puns is very difficult for artificial intelligence, as it requires complex understanding of context, multiple meanings, and sound associations that algorithms find hard to manage.",
            "Bob's Burgers has a quota: The writers for the animated TV show Bob's Burgers must include three or four pun options for the 'Burger of the Day,' the store next door, and the exterminator van for every episode script.",
            "They're not just for humor: While often used to make people laugh, puns also serve rhetorical purposes in literature and speech, such as adding emphasis, aiding memorability, or developing a character's wit.",
            "The biggest competition is a 'Pun-Off': The O. Henry Pun-Off World Championships is an annual competition held in Austin, Texas, featuring strict rules and two main events: 'Punniest of Show' (monologues) and 'Punslingers' (rapid-fire duels).",
            "They were once out of vogue: In the century after Shakespeare, prominent figures like John Dryden and Samuel Johnson derided puns, with Johnson famously calling them 'the lowest form of humor'."
        ];

        const outputElement = document.getElementById('json-output');
        const loadingOverlay = document.getElementById('loading-overlay');
        const factDisplay = document.getElementById('fact-display');
        const button = document.getElementById('analyze-button');
        const finalStatusMessageElement = document.getElementById('final-status-message');
        const resultsContainer = document.getElementById('results-container');

        function updateStatus(message, type = 'info') {
            finalStatusMessageElement.textContent = message;
            finalStatusMessageElement.className = `status-message ${type}`;
        }

        function startRotation() {
            loadingOverlay.classList.remove('hidden');
            outputElement.textContent = "";
            outputElement.classList.remove('visible');
            resultsContainer.innerHTML = "";

            function rotateFact() {
                factDisplay.textContent = PUN_FACTS[currentFactIndex];
                currentFactIndex = (currentFactIndex + 1) % PUN_FACTS.length;
            }

            rotateFact();
            rotationIntervalId = setInterval(rotateFact, FACT_INTERVAL);
        }

        function stopRotation(isSuccess = true) {
            clearInterval(rotationIntervalId);
            rotationIntervalId = null;
            loadingOverlay.classList.add('hidden');
        }

        function toggleRawJson() {
            outputElement.classList.toggle('visible');
        }

        function getPunTypeBadgeClass(punType) {
            const type = (punType || '').toLowerCase();
            if (['homophonic', 'homographic', 'recursive', 'antanaclasis'].includes(type)) {
                return type;
            }
            return 'unknown';
        }

        function renderResults(data) {
            // Handle both single and batch results
            const results = data.results || [data];

            let html = '';

            for (const result of results) {
                html += `
                    <div class="sentence-result">
                        <div class="sentence-header">
                            <p class="sentence-text">"${escapeHtml(result.sentence)}"</p>
                            <span class="pun-status ${result.has_pun ? 'has-pun' : 'no-pun'}">
                                ${result.has_pun ? 'âœ“ Pun Detected' : 'âœ— No Pun Detected'}
                            </span>
                        </div>
                `;

                if (result.has_pun && result.puns && result.puns.length > 0) {
                    for (const pun of result.puns) {
                        html += renderPunCard(pun);
                    }
                } else {
                    html += `
                        <div class="no-pun-message">
                            <p>No puns were identified in this sentence.</p>
                            ${result.analysis_notes ? `<p><em>Notes: ${escapeHtml(result.analysis_notes)}</em></p>` : ''}
                        </div>
                    `;
                }

                html += `</div>`;
            }

            resultsContainer.innerHTML = html;
        }

        function renderPunCard(pun) {
            const punTypeClass = getPunTypeBadgeClass(pun.pun_type);
            const fd = pun.frame_distance || {};
            const validation = pun.validation || {};

            return `
                <div class="pun-card">
                    <h3 class="pun-expression">"${escapeHtml(pun.word_or_expression)}"</h3>

                    <!-- Claude's Analysis -->
                    <div class="analysis-section claude-section">
                        <h4>Claude's Analysis</h4>
                        <div class="analysis-grid">
                            <div class="analysis-item">
                                <span class="analysis-label">Pun Type:</span>
                                <span class="analysis-value">
                                    <span class="pun-type-badge ${punTypeClass}">${escapeHtml(pun.pun_type || 'Unknown')}</span>
                                </span>
                            </div>
                            <div class="analysis-item">
                                <span class="analysis-label">First Sense:</span>
                                <span class="analysis-value">${escapeHtml(pun.sense1 || 'N/A')}</span>
                            </div>
                            <div class="analysis-item">
                                <span class="analysis-label">Second Sense:</span>
                                <span class="analysis-value">${escapeHtml(pun.sense2 || 'N/A')}</span>
                            </div>
                            <div class="analysis-item">
                                <span class="analysis-label">Explanation:</span>
                                <span class="analysis-value">${escapeHtml(pun.explanation || 'N/A')}</span>
                            </div>
                        </div>
                    </div>

                    <!-- FrameNet Analysis -->
                    <div class="analysis-section framenet-section">
                        <h4>FrameNet Analysis</h4>
                        <div class="analysis-grid">
                            <div class="analysis-item">
                                <span class="analysis-label">Frame Distance:</span>
                                <span class="analysis-value">
                                    <span class="distance-value">${fd.distance !== undefined ? fd.distance : 'N/A'}</span>
                                    ${fd.distance >= 0 ? ' (0 = same frame, higher = more distant)' : ''}
                                </span>
                            </div>
                            <div class="analysis-item">
                                <span class="analysis-label">Distance Type:</span>
                                <span class="analysis-value">${escapeHtml(fd.distance_type || 'N/A')}</span>
                            </div>
                            <div class="analysis-item">
                                <span class="analysis-label">Explanation:</span>
                                <span class="analysis-value">${escapeHtml(fd.explanation || 'N/A')}</span>
                            </div>
                        </div>

                        ${fd.sense1_frame ? `
                            <div class="frame-box">
                                <div class="frame-name">Frame 1: ${escapeHtml(fd.sense1_frame.frame_name)}</div>
                                <div class="frame-definition">${escapeHtml(fd.sense1_frame.frame_definition || 'No definition available')}</div>
                            </div>
                        ` : ''}

                        ${fd.sense2_frame ? `
                            <div class="frame-box">
                                <div class="frame-name">Frame 2: ${escapeHtml(fd.sense2_frame.frame_name)}</div>
                                <div class="frame-definition">${escapeHtml(fd.sense2_frame.frame_definition || 'No definition available')}</div>
                            </div>
                        ` : ''}
                    </div>

                    <!-- Validation Results -->
                    ${pun.validation ? `
                        <div class="analysis-section validation-section">
                            <h4>Validation Results</h4>
                            <div class="analysis-grid">
                                <div class="analysis-item">
                                    <span class="analysis-label">Distributional:</span>
                                    <span class="analysis-value">
                                        <span class="validation-status ${validation.distributional_valid ? 'valid' : 'invalid'}">
                                            ${validation.distributional_valid ? 'âœ“ Valid' : 'âœ— Invalid'}
                                        </span>
                                    </span>
                                </div>
                                <div class="analysis-item">
                                    <span class="analysis-label">Substitution:</span>
                                    <span class="analysis-value">
                                        <span class="validation-status ${validation.substitution_valid ? 'valid' : 'invalid'}">
                                            ${validation.substitution_valid ? 'âœ“ Valid' : 'âœ— Invalid'}
                                        </span>
                                    </span>
                                </div>
                                <div class="analysis-item">
                                    <span class="analysis-label">Confidence:</span>
                                    <span class="analysis-value">
                                        ${Math.round((pun.confidence || 0) * 100)}%
                                        <div class="confidence-bar">
                                            <div class="confidence-fill" style="width: ${(pun.confidence || 0) * 100}%"></div>
                                        </div>
                                    </span>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function analyzeSentences() {
            const input = document.getElementById('sentence-input').value;
            const sentences = input.split('\n').map(s => s.trim()).filter(s => s !== '');

            if (sentences.length === 0) {
                updateStatus("Please enter at least one sentence.", 'error');
                return;
            }

            const isBatch = sentences.length > 1;
            const url = isBatch ? `/analyze/batch` : `/analyze`;
            const body = isBatch ? { sentences: sentences } : { sentence: sentences[0] };

            button.disabled = true;
            startRotation();

            let success = false;
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                outputElement.textContent = JSON.stringify(data, null, 2);

                if (response.ok) {
                    success = true;
                    updateStatus("Analysis complete!", 'success');
                    renderResults(data);
                } else {
                    updateStatus(`API Error: ${data.error || 'Unknown error'}`, 'error');
                    resultsContainer.innerHTML = `<div class="status-message error">Error: ${escapeHtml(data.message || data.error || 'Unknown error')}</div>`;
                }
            } catch (error) {
                updateStatus(`Network Error: ${error.message}`, 'error');
                resultsContainer.innerHTML = `<div class="status-message error">Network Error: ${escapeHtml(error.message)}</div>`;
            } finally {
                stopRotation(success);
                button.disabled = false;
            }
        }
    </script>
</body>
</html>